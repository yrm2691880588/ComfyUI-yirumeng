# ComfyUI-yirumeng 自定义节点集合

这是一个为 ComfyUI 开发的自定义节点集合，旨在提供便捷的 AI 模型集成（如火山引擎豆包大模型）和实用的图像/视频处理工具。

## 1. 项目简介和功能特性

本项目包含一系列功能强大的自定义节点，主要涵盖以下领域：
- **大语言模型集成**：深度集成火山引擎豆包（Doubao）大模型，支持文本对话、多模态理解（图像/视频/文档分析）。
- **视频生成与处理**：支持豆包视频生成 API（文生视频、图生视频），以及本地视频保存（支持 MP4, GIF, WebP 等格式）。
- **图像处理工具**：高级图像保存（支持元数据、自定义路径）、智能图像裁剪（按比例/数值）、色彩调整预览等。
- **文本与逻辑工具**：文本替换、拼接、输入等实用工具，方便构建复杂工作流。
- **第三方 API 集成**：NanoBanana2 Pro 图像生成接口支持。

所有节点均经过优化，具备中文界面和详细的参数说明，适合中文用户使用。

## 2. 安装方法

1.  **进入 ComfyUI 插件目录**：
    打开终端（CMD/PowerShell），进入你的 ComfyUI `custom_nodes` 目录：
    ```bash
    cd path/to/ComfyUI/custom_nodes
    ```

2.  **克隆仓库**：
    ```bash
    git clone https://github.com/your-repo/ComfyUI-yirumeng.git
    ```

3.  **安装依赖**：
    本项目依赖以下 Python 库，请确保在 ComfyUI 的 Python 环境中安装：
    ```bash
    pip install requests imageio imageio-ffmpeg
    ```
    *注意：如果你使用的是 ComfyUI 便携版，请使用嵌入式 Python 运行 pip 命令，例如 `python_embeded\python.exe -m pip install ...`*

4.  **重启 ComfyUI**：
    重启 ComfyUI 即可在节点列表中看到 `yirumeng` 分类。

## 3. 配置说明

为了保护您的隐私，本项目**严禁**将 API Key 保存到代码中。推荐使用以下方式配置 API Key：

### 环境变量（推荐）
在您的系统环境变量中添加以下键值：
- `ARK_API_KEY`: 用于火山引擎豆包相关节点。
- `NANOBANANA_API_KEY`: 用于 NanoBanana 相关节点。

### 节点输入
每个涉及 API 调用的节点都提供了 `API_KEY` 输入框。您可以直接在节点上粘贴 Key，但请注意**不要分享包含 Key 的工作流文件**。

## 4. 使用方法

安装完成后，您可以通过以下方式找到节点：
- **右键菜单**：在 ComfyUI 画布空白处右键 -> `yirumeng` -> 选择相应子分类（如 `API`、`图像`、`视频` 等）。
- **双击搜索**：双击画布，输入节点名称（如 "豆包"、"保存"）进行搜索。所有节点均带有 `@伊汝梦` 后缀，方便识别。

## 5. 参数说明

以下是核心节点的参数简要说明：

### 豆包大语言模型@伊汝梦
| 参数 | 说明 |
| :--- | :--- |
| **提示词** | 用户的输入问题或指令。 |
| **模型** | 选择豆包模型版本（支持 doubao-seed-2-0-mini-260215 等最新模型）。 |
| **API_KEY** | 火山引擎 API Key。 |
| **图像/视频/文档** | (可选) 多模态输入，连接对应节点输出。 |

### 豆包视频API@伊汝梦
| 参数 | 说明 |
| :--- | :--- |
| **生成模式** | 文生视频、图生视频、首尾帧视频。 |
| **模型** | 选择视频生成模型（如 doubao-seedance-1-5-pro）。 |
| **比例/分辨率** | 视频的画幅比例和清晰度。 |

### 高级图像保存@伊汝梦
| 参数 | 说明 |
| :--- | :--- |
| **图像格式** | 支持 PNG, JPG, WEBP。 |
| **自定义保存路径** | 支持相对路径（相对于 output 目录）或绝对路径。 |
| **保存元数据** | 是否将工作流信息写入图片（仅 PNG 支持较好）。 |

## 6. 工作流示例

### 示例 1：豆包多模态图像理解
1. 加载一张图像 (Load Image)。
2. 连接到 **豆包大语言模型@伊汝梦** 的 `图像` 输入端口。
3. 在 `提示词` 中输入：“请描述这张图片的内容”。
4. 运行工作流，查看输出的文本描述。

### 示例 2：文生视频并保存
1. 添加 **豆包视频API@伊汝梦** 节点。
2. 输入提示词：“一只在草地上奔跑的金毛犬，4k画质”。
3. 连接输出的 `视频对象` 到 **视频保存@伊汝梦** 节点。
4. 设置保存格式为 `mp4`，运行即可生成并保存视频。

## 7. 常见问题 (FAQ)

**Q: 节点显示红色或加载失败？**
A: 请检查是否安装了必要的 Python 依赖库 (`requests`, `imageio`)。如果是便携版，请确保安装到了便携版的 python 环境中。

**Q: API 调用报错？**
A: 请检查 API Key 是否正确，以及账户余额是否充足。对于火山引擎，请确保已在控制台开通了对应模型的推理接入点。

**Q: 视频保存失败？**
A: 视频保存依赖 `imageio-ffmpeg`，请尝试运行 `pip install imageio-ffmpeg`。

## 8. 注意事项

1.  **API Key 安全**：请勿将包含真实 API Key 的工作流截图或 JSON 文件分享给他人。
2.  **网络连接**：API 节点需要访问互联网，请确保您的网络环境可以连接到火山引擎或对应服务商的服务器。
3.  **文件路径**：在使用自定义路径保存文件时，请确保 ComfyUI 有权限写入该目录。

## 9. 参考资料链接

- [ComfyUI 官方仓库](https://github.com/comfyanonymous/ComfyUI)
- [火山引擎方舟平台](https://www.volcengine.com/product/ark)
- [豆包模型文档](https://www.volcengine.com/docs/82379/1099475)
